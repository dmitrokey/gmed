<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmed Cosmetics PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #1e293b; -webkit-tap-highlight-color: transparent; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .dropdown-content { display: none; position: absolute; right: 0; top: 100%; background: white; min-width: 220px; max-height: 380px; overflow-y: auto; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border-radius: 1.25rem; z-index: 100; border: 1px solid #f1f5f9; padding: 8px; }
        .dropdown-content.show { display: block; }
        .opt-input { font-size: 11px !important; font-weight: 700 !important; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        #pdf-template { display: none; padding: 30px; background: white; }

        .desc-wrapper { display: block; position: relative; max-height: 2.8rem; overflow: hidden; transition: max-height 0.5s ease-in-out; white-space: pre-line; }
        .desc-wrapper.expanded { max-height: 2000px; transition: max-height 0.8s ease-in; }
        .desc-wrapper:not(.expanded)::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 15px; background: linear-gradient(transparent, white); }
    </style>
</head>
<body class="pb-20">

<header class="glass-header sticky top-0 z-50 px-4 py-3">
    <div class="container mx-auto flex justify-between items-center">
        <img src="https://res.cloudinary.com/dtmvidhde/image/upload/v1770034516/Gmed_cosmetics_z7hp7a.jpg" class="h-10 rounded-lg shadow-sm">
        <div class="flex items-center gap-2">
            <button onclick="generatePDF()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-blue-50 text-blue-600 shadow-sm" title="PDF Прайс">
                <i class="fas fa-file-pdf text-sm"></i>
            </button>
            <div class="relative">
                <button onclick="document.getElementById('catDropdown').classList.toggle('show')" class="px-5 py-2.5 bg-emerald-500 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-lg shadow-emerald-100">Категорії</button>
                <div id="catDropdown" class="dropdown-content mt-2"></div>
            </div>
            <button onclick="handleAuth()" id="adminBtn" class="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-900 text-white shadow-lg">
                <i class="fas fa-lock text-xs"></i>
            </button>
        </div>
    </div>
</header>

<div id="adminPanel" class="hidden sticky top-[65px] z-40 bg-slate-900 text-white border-b border-emerald-500/30">
    <div class="container mx-auto px-4 py-2 flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center gap-3 bg-white/5 p-1 rounded-xl">
            <div class="flex flex-col items-center px-2 border-l border-white/10">
                <span class="text-[7px] text-emerald-400 uppercase">Спец №1</span>
                <input type="number" id="inputSpec1" step="0.1" class="w-12 bg-transparent text-xs font-bold text-center text-emerald-400 outline-none">
            </div>
            <div class="flex flex-col items-center px-2 border-l border-white/10">
                <span class="text-[7px] text-blue-400 uppercase">Спец №2</span>
                <input type="number" id="inputSpec2" step="0.1" class="w-12 bg-transparent text-xs font-bold text-center text-blue-400 outline-none">
            </div>
            <button onclick="saveRates()" class="bg-emerald-500 px-3 py-2 rounded-lg text-[9px] font-black uppercase">ОК</button>
        </div>
        <button onclick="openEditModal()" class="bg-blue-600 px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-wider">+ Додати товар</button>
    </div>
</div>

<main class="container mx-auto px-4 mt-8">
    <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
</main>

<div id="productModal" class="hidden fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm flex items-center justify-center p-2">
    <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl flex flex-col max-h-[95vh]">
        <div class="h-24 bg-slate-50 flex items-center justify-center p-2 border-b shrink-0">
            <img id="modalPreview" src="" class="max-h-full object-contain">
        </div>

        <form id="productForm" class="p-5 space-y-3 overflow-y-auto">
            <input type="hidden" id="edit_id">
            <input type="text" id="f_name" placeholder="Назва товару" class="w-full bg-slate-100 rounded-xl p-3 text-sm font-bold outline-none">
            <textarea id="f_description" placeholder="Опис товару (склад, застосування...)" rows="3" class="w-full bg-slate-50 rounded-xl p-3 text-xs outline-none border border-slate-100 resize-none"></textarea>

            <div class="grid grid-cols-2 gap-2">
                <input list="categoriesList" id="f_category" placeholder="Категорія" class="bg-slate-50 rounded-lg p-2 text-xs font-bold outline-none border border-slate-100">
                <datalist id="categoriesList"></datalist>
                <input type="text" id="f_dosage" placeholder="Одиниці товару (шт., уп. шпр.)" class="bg-slate-50 rounded-lg p-2 text-xs font-bold outline-none border border-slate-100">
            </div>
            <button type="button" onclick="openUploadWidget()" class="bg-blue-600 text-white px-3 py-2 rounded-lg text-[10px]">Завантажити фото</button>
            <input type="text" id="f_image_url" oninput="document.getElementById('modalPreview').src=this.value" placeholder="URL зображення" class="w-full bg-slate-50 rounded-lg p-2 text-[10px] outline-none border border-slate-100">

            <!-- Блок цін -->
            <div class="bg-emerald-50/50 p-3 rounded-xl border border-emerald-100 flex items-center gap-3">
                <div class="flex-grow">
                    <p class="text-[8px] font-black text-emerald-700 uppercase mb-1">Базова ціна</p>
                    <div class="flex gap-2">
                        <input type="number" id="f_price_base" step="0.01" class="w-full rounded-lg p-2 text-sm font-bold border-none shadow-sm">
                        <select id="f_currency" class="rounded-lg p-2 text-xs font-bold shadow-sm border-none"><option value="€">€</option><option value="грн">грн</option><option value="$">$</option></select>
                    </div>
                </div>
                <div class="w-28">
                    <p class="text-[7px] font-bold text-slate-500 uppercase mb-1 text-center">Тип курсу</p>
                    <select id="f_is_special_rate" class="w-full rounded-lg p-2 text-[10px] font-bold border-none shadow-sm bg-white">
                        <option value="0">Без спецкурсу (номінал)</option>
                        <option value="1">Спецкурс №1 (грн)</option>
                        <option value="2">Спецкурс №2 (грн)</option>
                    </select>
                </div>
            </div>

            <!-- Оптові умови -->
            <div class="space-y-1">
                <p class="text-[8px] font-black text-slate-400 uppercase ml-1">Оптові умови</p>
                <div class="grid grid-cols-1 gap-1">
                    ${[2,3,4].map(i => `
                    <div class="flex items-center gap-1 bg-slate-50 p-1 rounded-lg">
                        <input type="text" id="f_condition_${i}_val" placeholder="К-сть" class="opt-input w-12 p-2 rounded-md bg-white text-center">
                        <input type="text" id="f_condition_${i}_unit" placeholder="Од." class="opt-input w-12 p-2 rounded-md bg-white text-center">
                        <input type="number" id="f_price_${i}_usd_eur" step="0.01" placeholder="Ціна" class="opt-input flex-grow p-2 rounded-md bg-white text-center text-emerald-600">
                    </div>`).join('')}
                </div>
            </div>

            <div class="flex gap-2 pt-2 shrink-0">
                <button type="button" onclick="closeModal()" class="flex-1 bg-slate-100 text-slate-500 py-4 rounded-xl font-bold text-[9px] uppercase">Скасувати</button>
                <button type="button" onclick="saveProduct()" class="flex-[2] bg-slate-900 text-white py-4 rounded-xl font-black text-[9px] uppercase tracking-widest">Зберегти</button>
            </div>
        </form>
    </div>
</div>

<div id="pdf-template">
    <div style="text-align: center; border-bottom: 2px solid #10b981; padding-bottom: 20px; margin-bottom: 20px;">
        <h1 style="font-size: 28px; color: #0f172a; margin: 0;">GMED COSMETICS</h1>
        <p style="font-size: 12px; color: #64748b; margin-top: 5px;">Прайс-лист та каталог продукції</p>
    </div>
    <div id="pdf-list"></div>
</div>

<!-- SUPABASE + логіка сайту -->
<script>
const SUPABASE_URL = 'https://djrrojucwvafgvetdrnf.supabase.co';
const SUPABASE_KEY = 'YOUR_KEY_HERE';
const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let allProducts = [];
let rates = { euro: 44.5, usd: 41.5, spec1: 45.0, spec2: 46.0 };
let currentFilter = 'Всі';

// --- Далі твій JS код init, loadData, renderProducts, saveProduct і тд ---
// Тут нічого не міняємо, залишаємо як у твоєму коді

init();
</script>

<!-- Cloudinary Widget -->
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
<script>
function openUploadWidget() {
   const widget = cloudinary.createUploadWidget({
       cloudName: 'dtmvidhde',
       uploadPreset: 'products_unsigned',
       cropping: true,
       croppingAspectRatio: 1,
       croppingCoordinatesMode: 'custom',
       multiple: false,
       folder: 'products'
   }, (error, result) => {
       if (!error && result && result.event === "success") {
           const url = result.info.secure_url;
           document.getElementById('modalPreview').src = url;
           document.getElementById('f_image_url').value = url;
       } else if (error) console.error(error);
   });
   widget.open();
}

// --- Підтримка Ctrl+V для вставки картинки ---
document.addEventListener('paste', function(e) {
    const items = e.clipboardData?.items;
    if (!items) return;
    for (let i = 0; i < items.length; i++) {
        const item = items[i];
        if (item.type.indexOf("image") !== -1) {
            const file = item.getAsFile();
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('modalPreview').src = event.target.result;

                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', 'products_unsigned');

                fetch('https://api.cloudinary.com/v1_1/dtmvidhde/image/upload', { method: 'POST', body: formData })
                .then(res => res.json())
                .then(data => {
                    document.getElementById('modalPreview').src = data.secure_url;
                    document.getElementById('f_image_url').value = data.secure_url;
                }).catch(err => console.error(err));
            };
            reader.readAsDataURL(file);
            e.preventDefault();
            break;
        }
    }
});
</script>

</body>
</html>
