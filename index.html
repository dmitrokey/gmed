function renderDisplay() {
    const filtered = currentCategory === 'Всі' ? allProducts : allProducts.filter(p => p.category === currentCategory);
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';
    
    filtered.forEach(p => {
        let priceHTML = '';
        
        // Перевіряємо статус "Спецкурс" (регістронезалежно на всяк випадок)
        if (p.is_euro_special && p.is_euro_special.trim() === 'Спецкурс') {
            
            // ОЧИЩЕННЯ ДАНИХ: видаляємо все, крім цифр, крапок та ком
            let rawPrice = p.price_text ? String(p.price_text).replace(/[^\d.,]/g, '').replace(',', '.') : '0';
            let numericPrice = parseFloat(rawPrice);

            if (!isNaN(numericPrice)) {
                const uahValue = Math.round(numericPrice * globalEurRate).toLocaleString();
                priceHTML = `
                    <div class="text-[20px] font-black text-slate-900 leading-none">${uahValue} <span class="text-[10px] text-slate-400 font-bold uppercase">ГРН</span></div>
                    <div class="text-[10px] text-emerald-500 font-bold mt-1 uppercase tracking-widest">Ціна: ${numericPrice}€ (курс ${globalEurRate})</div>
                `;
            } else {
                priceHTML = `<div class="text-[18px] font-black text-red-500 italic leading-none">Ціна не вказана</div>`;
            }
        } else {
            // Для звичайних товарів виводимо як є
            priceHTML = `<div class="text-[20px] font-black text-slate-900 leading-none">${p.price_text || '—'}</div>`;
        }

        const card = document.createElement('div');
        card.className = 'product-card relative flex flex-col h-full';
        card.innerHTML = `
            <div class="aspect-square p-8 flex items-center justify-center bg-white">
                <img src="${p.image_url || 'https://via.placeholder.com/400'}" class="max-h-full object-contain" onerror="this.src='https://via.placeholder.com/400?text=No+Image'">
            </div>
            <div class="p-6 flex flex-col flex-grow border-t border-slate-50">
                <h3 class="text-[13px] font-black text-slate-800 uppercase mb-1 leading-tight min-h-[2em]">${p.name || 'Без назви'}</h3>
                <p class="text-[10px] text-slate-400 font-bold mb-4 italic uppercase tracking-tighter">${p.dosage || ''}</p>
                
                ${p.description ? `<div class="text-[9px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg self-start mb-6 uppercase tracking-wider border border-emerald-100">${p.description}</div>` : '<div class="flex-grow"></div>'}
                
                <div class="mt-auto space-y-4">
                    <div class="pt-4 border-t border-slate-100">${priceHTML}</div>
                    <a href="https://t.me/VikusyaGuzeeva" target="_blank" class="no-print order-btn-full">
                        <i class="fab fa-telegram-plane"></i> Замовити
                    </a>
                </div>
            </div>
        `;
        
        if (isAdminMode) {
            const tools = document.createElement('div');
            tools.className = 'absolute top-4 right-4 flex gap-2 z-20 no-print';
            tools.innerHTML = `
                <button onclick="prepareEdit('${p.id}')" class="w-8 h-8 bg-white/90 shadow-md rounded-full text-blue-500 flex items-center justify-center border border-slate-100 hover:bg-blue-50"><i class="fas fa-pen text-[10px]"></i></button>
                <button onclick="deleteProduct('${p.id}')" class="w-8 h-8 bg-white/90 shadow-md rounded-full text-red-400 flex items-center justify-center border border-slate-100 hover:bg-red-50"><i class="fas fa-trash text-[10px]"></i></button>
            `;
            card.appendChild(tools);
        }
        grid.appendChild(card);
    });
}
